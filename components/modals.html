<!-- Login Modal -->
<div id="loginModal" class="modal">
    <div class="bg-white p-8 rounded-lg shadow-2xl max-w-md w-full mx-4">
        <div class="text-center mb-6">
            <h2 class="text-2xl font-bold text-gray-800">تسجيل الدخول</h2>
            <p class="text-gray-600 mt-2">مرحباً بك مرة أخرى</p>
        </div>
        <form id="loginForm">
            <div class="mb-4">
                <label class="form-label">البريد الإلكتروني</label>
                <input type="email" id="loginEmail" required class="form-input" placeholder="أدخل بريدك الإلكتروني">
            </div>
            <div class="mb-6">
                <label class="form-label">كلمة المرور</label>
                <input type="password" id="loginPassword" required class="form-input" placeholder="أدخل كلمة المرور">
            </div>
            <div class="flex items-center justify-between mb-6">
                <label class="flex items-center">
                    <input type="checkbox" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                    <span class="mr-2 text-sm text-gray-600">تذكرني</span>
                </label>
                <a href="#" class="text-sm text-blue-600 hover:text-blue-700">نسيت كلمة المرور؟</a>
            </div>
            <button type="submit" class="w-full btn-primary mb-4">تسجيل الدخول</button>
            <div class="text-center">
                <p class="text-sm text-gray-600">
                    ليس لديك حساب؟ 
                    <button type="button" onclick="closeModal('loginModal'); document.getElementById('registerModal').classList.add('show')" 
                            class="text-blue-600 hover:text-blue-700 font-medium">إنشاء حساب جديد</button>
                </p>
            </div>
        </form>
        <button onclick="closeModal('loginModal')" class="absolute top-4 left-4 text-gray-400 hover:text-gray-600">
            <i class="fas fa-times"></i>
        </button>
    </div>
</div>

<!-- Register Modal -->
<div id="registerModal" class="modal">
    <div class="bg-white p-8 rounded-lg shadow-2xl max-w-md w-full mx-4">
        <div class="text-center mb-6">
            <h2 class="text-2xl font-bold text-gray-800">إنشاء حساب جديد</h2>
            <p class="text-gray-600 mt-2">انضم إلينا اليوم</p>
        </div>
        <form id="registerForm">
            <div class="mb-4">
                <label class="form-label">الاسم الكامل</label>
                <input type="text" id="registerName" required class="form-input" placeholder="أدخل اسمك الكامل">
            </div>
            <div class="mb-4">
                <label class="form-label">البريد الإلكتروني</label>
                <input type="email" id="registerEmail" required class="form-input" placeholder="أدخل بريدك الإلكتروني">
            </div>
            <div class="mb-4">
                <label class="form-label">رقم الهاتف</label>
                <input type="tel" id="registerPhone" required class="form-input" placeholder="أدخل رقم هاتفك">
            </div>
            <div class="mb-4">
                <label class="form-label">كلمة المرور</label>
                <input type="password" id="registerPassword" required class="form-input" placeholder="أدخل كلمة المرور">
            </div>
            <div class="mb-6">
                <label class="form-label">تأكيد كلمة المرور</label>
                <input type="password" id="registerConfirmPassword" required class="form-input" placeholder="أعد إدخال كلمة المرور">
            </div>
            <div class="mb-6">
                <label class="flex items-center">
                    <input type="checkbox" required class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                    <span class="mr-2 text-sm text-gray-600">أوافق على <a href="#" class="text-blue-600 hover:text-blue-700">الشروط والأحكام</a></span>
                </label>
            </div>
            <button type="submit" class="w-full btn-primary mb-4">إنشاء الحساب</button>
            <div class="text-center">
                <p class="text-sm text-gray-600">
                    لديك حساب بالفعل؟ 
                    <button type="button" onclick="closeModal('registerModal'); showLogin()" 
                            class="text-blue-600 hover:text-blue-700 font-medium">تسجيل الدخول</button>
                </p>
            </div>
        </form>
        <button onclick="closeModal('registerModal')" class="absolute top-4 left-4 text-gray-400 hover:text-gray-600">
            <i class="fas fa-times"></i>
        </button>
    </div>
</div>

<!-- Payment Modal -->
<div id="paymentModal" class="modal">
    <div class="bg-white p-8 rounded-lg shadow-2xl max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
        <div class="text-center mb-6">
            <h2 class="text-2xl font-bold text-gray-800">إتمام الدفع</h2>
            <p class="text-gray-600 mt-2">الكورس: <span id="paymentCourseTitle" class="font-semibold"></span></p>
            <p class="text-2xl font-bold text-blue-600 mt-2" id="paymentCoursePrice"></p>
        </div>
        
        <!-- Coupon Section -->
        <div class="mb-6 p-4 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg border border-green-200">
            <div class="flex items-center justify-between mb-3">
                <label class="form-label mb-0 text-green-700 font-semibold">
                    <i class="fas fa-ticket-alt ml-2"></i>
                    كود الخصم
                </label>
                <button type="button" onclick="applyCoupon()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors text-sm font-medium">
                    <i class="fas fa-check ml-1"></i>
                    تطبيق
                </button>
            </div>
            <input type="text" id="couponCode" class="form-input border-green-300 focus:border-green-500" placeholder="أدخل كود الخصم (مثال: SAVE20)">
            <div id="couponMessage" class="text-sm mt-2 hidden"></div>
            <div class="mt-2 text-xs text-gray-600">
                <i class="fas fa-info-circle ml-1"></i>
                استخدم الأكواد: SAVE10, SAVE20, STUDENT50 للحصول على خصم
            </div>
        </div>
        
        <!-- Payment Methods -->
        <div class="mb-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">
                <i class="fas fa-credit-card ml-2"></i>
                طريقة الدفع
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <label class="payment-method-card cursor-pointer">
                    <input type="radio" name="paymentMethod" value="credit" checked class="sr-only">
                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 transition-colors payment-option">
                        <div class="text-center">
                            <i class="fas fa-credit-card text-2xl text-blue-600 mb-2"></i>
                            <p class="font-medium text-gray-800">بطاقة ائتمان</p>
                            <p class="text-xs text-gray-500">Visa, MasterCard</p>
                        </div>
                    </div>
                </label>
                <label class="payment-method-card cursor-pointer">
                    <input type="radio" name="paymentMethod" value="paypal" class="sr-only">
                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 transition-colors payment-option">
                        <div class="text-center">
                            <i class="fab fa-paypal text-2xl text-blue-600 mb-2"></i>
                            <p class="font-medium text-gray-800">PayPal</p>
                            <p class="text-xs text-gray-500">دفع آمن</p>
                        </div>
                    </div>
                </label>
                <label class="payment-method-card cursor-pointer">
                    <input type="radio" name="paymentMethod" value="vodafone" class="sr-only">
                    <div class="p-4 border-2 border-gray-200 rounded-lg hover:border-blue-500 transition-colors payment-option">
                        <div class="text-center">
                            <i class="fas fa-mobile-alt text-2xl text-red-600 mb-2"></i>
                            <p class="font-medium text-gray-800">فودافون كاش</p>
                            <p class="text-xs text-gray-500">دفع بالمحفظة</p>
                        </div>
                    </div>
                </label>
            </div>
        </div>
        
        <form id="paymentForm">
            <!-- Credit Card Details -->
            <div id="creditCardDetails" class="payment-details">
                <div class="mb-4">
                    <label class="form-label">اسم حامل البطاقة</label>
                    <input type="text" id="cardHolderName" class="form-input" placeholder="الاسم كما هو مكتوب على البطاقة">
                </div>
                <div class="mb-4">
                    <label class="form-label">رقم البطاقة</label>
                    <input type="text" id="cardNumber" class="form-input" placeholder="1234 5678 9012 3456" maxlength="19">
                    <div class="flex items-center mt-2 space-x-2 space-x-reverse">
                        <img src="https://img.icons8.com/color/24/000000/visa.png" alt="Visa" class="h-6">
                        <img src="https://img.icons8.com/color/24/000000/mastercard.png" alt="MasterCard" class="h-6">
                        <img src="https://img.icons8.com/color/24/000000/amex.png" alt="Amex" class="h-6">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="form-label">تاريخ الانتهاء</label>
                        <input type="text" id="expiryDate" class="form-input" placeholder="MM/YY" maxlength="5">
                    </div>
                    <div>
                        <label class="form-label">CVV</label>
                        <input type="text" id="cvv" class="form-input" placeholder="123" maxlength="3">
                    </div>
                </div>
            </div>
            
            <!-- PayPal Details -->
            <div id="paypalDetails" class="payment-details hidden">
                <div class="text-center p-6 bg-blue-50 rounded-lg">
                    <i class="fab fa-paypal text-4xl text-blue-600 mb-4"></i>
                    <p class="text-gray-700 mb-4">سيتم تحويلك إلى PayPal لإتمام عملية الدفع</p>
                    <div class="text-sm text-gray-600">
                        <i class="fas fa-shield-alt ml-1"></i>
                        حماية المشتري PayPal
                    </div>
                </div>
            </div>
            
            <!-- Vodafone Cash Details -->
            <div id="vodafoneDetails" class="payment-details hidden">
                <div class="mb-4">
                    <label class="form-label">رقم محفظة فودافون كاش</label>
                    <input type="text" id="vodafoneNumber" class="form-input" placeholder="010XXXXXXXX" maxlength="11">
                </div>
                <div class="mb-4">
                    <label class="form-label">رقم الهوية أو الجواز</label>
                    <input type="text" id="nationalId" class="form-input" placeholder="رقم الهوية (14 رقم)" maxlength="14">
                </div>
                <div class="bg-red-50 p-4 rounded-lg">
                    <p class="text-sm text-red-700">
                        <i class="fas fa-info-circle ml-1"></i>
                        سيتم إرسال رسالة تأكيد على رقمك لإتمام عملية الدفع
                    </p>
                </div>
            </div>
            
            <!-- Price Summary -->
            <div class="border-t pt-6 mb-6">
                <h4 class="font-semibold text-gray-800 mb-4">ملخص الطلب</h4>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-gray-600">سعر الكورس:</span>
                        <span id="originalPrice" class="font-medium">299 ج.م</span>
                    </div>
                    <div id="discountRow" class="flex justify-between items-center mb-2 hidden">
                        <span class="text-green-600">خصم الكوبون:</span>
                        <span id="discountAmount" class="text-green-600 font-medium">-0 ج.م</span>
                    </div>
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-gray-600">رسوم الخدمة:</span>
                        <span class="text-gray-600">0 ج.م</span>
                    </div>
                    <hr class="my-3">
                    <div class="flex justify-between items-center text-xl font-bold">
                        <span>المجموع النهائي:</span>
                        <span id="finalPrice" class="text-blue-600">299 ج.م</span>
                    </div>
                </div>
            </div>
            
            <!-- Terms and Conditions -->
            <div class="mb-6">
                <label class="flex items-start">
                    <input type="checkbox" id="agreeTerms" class="mt-1 ml-2" required>
                    <span class="text-sm text-gray-600">
                        أوافق على 
                        <a href="#" class="text-blue-600 hover:text-blue-700 underline">الشروط والأحكام</a>
                        و 
                        <a href="#" class="text-blue-600 hover:text-blue-700 underline">سياسة الخصوصية</a>
                    </span>
                </label>
            </div>
            
            <button type="submit" class="w-full btn-primary py-4 text-lg font-semibold mb-4">
                <i class="fas fa-lock ml-2"></i>
                إتمام الدفع الآن
            </button>
            
            <div class="text-center">
                <div class="flex items-center justify-center space-x-4 space-x-reverse mb-2">
                    <i class="fas fa-shield-alt text-green-600"></i>
                    <span class="text-sm text-gray-600">دفع آمن ومشفر 256-bit SSL</span>
                </div>
                <div class="flex items-center justify-center space-x-2 space-x-reverse">
                    <img src="https://img.icons8.com/color/20/000000/ssl-security.png" alt="SSL">
                    <img src="https://img.icons8.com/color/20/000000/security-checked.png" alt="Security">
                    <span class="text-xs text-gray-500">محمي بأعلى معايير الأمان</span>
                </div>
            </div>
        </form>
        
        <button onclick="closeModal('paymentModal')" class="absolute top-4 left-4 text-gray-500 hover:text-gray-700 text-2xl">
            &times;
        </button>
    </div>
</div>

<!-- Add Course Modal -->
<div id="addCourseModal" class="modal">
    <div class="bg-white p-8 rounded-lg shadow-2xl max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
        <h2 class="text-2xl font-bold text-gray-800 mb-6">إضافة كورس جديد</h2>
        <form id="addCourseForm">
            <div class="mb-4">
                <label class="form-label">عنوان الكورس</label>
                <input type="text" name="title" required class="form-input" placeholder="مثال: أساسيات البرمجة">
            </div>
            <div class="mb-4">
                <label class="form-label">وصف الكورس</label>
                <textarea name="description" required class="form-input" rows="4" 
                          placeholder="اكتب وصفاً مفصلاً عن الكورس..."></textarea>
            </div>
            <div class="mb-6">
                <label class="form-label">صورة الكورس</label>
                <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                    <i class="fas fa-cloud-upload-alt text-3xl text-gray-400 mb-2"></i>
                    <p class="text-gray-600">اسحب الصورة هنا أو انقر للاختيار</p>
                    <input type="file" accept="image/*" class="hidden">
                </div>
            </div>
            <div class="flex justify-end space-x-4 space-x-reverse">
                <button type="button" onclick="closeModal('addCourseModal')" class="btn-secondary">إلغاء</button>
                <button type="submit" class="btn-primary">إضافة الكورس</button>
            </div>
        </form>
        <button onclick="closeModal('addCourseModal')" class="absolute top-4 left-4 text-gray-400 hover:text-gray-600">
            <i class="fas fa-times"></i>
        </button>
    </div>
</div>

<!-- Create Coupon Modal -->
<div id="createCouponModal" class="modal">
    <div class="bg-white p-8 rounded-lg shadow-2xl max-w-md w-full mx-4">
        <div class="text-center mb-6">
            <h2 class="text-2xl font-bold text-gray-800">إنشاء كوبون خصم</h2>
        </div>
        <form id="createCouponForm">
            <div class="mb-4">
                <label class="form-label">كود الكوبون</label>
                <input type="text" required class="form-input" placeholder="مثال: SAVE20">
            </div>
            <div class="mb-4">
                <label class="form-label">نوع الخصم</label>
                <select required class="form-input" onchange="toggleDiscountType(this.value)">
                    <option value="">اختر نوع الخصم</option>
                    <option value="percentage">نسبة مئوية</option>
                    <option value="fixed">مبلغ ثابت</option>
                </select>
            </div>
            <div class="mb-4">
                <label class="form-label">قيمة الخصم</label>
                <input type="number" required class="form-input" placeholder="20">
            </div>
            <div class="mb-4">
                <label class="form-label">تاريخ الانتهاء</label>
                <input type="date" required class="form-input">
            </div>
            <div class="mb-6">
                <label class="form-label">عدد مرات الاستخدام</label>
                <input type="number" class="form-input" placeholder="100">
            </div>
            <div class="flex justify-end space-x-4 space-x-reverse">
                <button type="button" onclick="closeModal('createCouponModal')" class="btn-secondary">إلغاء</button>
                <button type="submit" class="btn-primary">إنشاء الكوبون</button>
            </div>
        </form>
        <button onclick="closeModal('createCouponModal')" class="absolute top-4 left-4 text-gray-400 hover:text-gray-600">
            <i class="fas fa-times"></i>
        </button>
    </div>
</div>

<!-- Course Player Modal -->
<div id="coursePlayerModal" class="modal">
    <div class="bg-white rounded-lg shadow-2xl max-w-6xl w-full mx-4 max-h-screen overflow-y-auto">
        <div class="p-6 border-b border-gray-200">
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-bold text-gray-800" id="playerCourseTitle">عنوان الكورس</h2>
                <button onclick="closeModal('coursePlayerModal')" class="text-gray-400 hover:text-gray-600">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 p-6">
            <!-- Video Player -->
            <div class="lg:col-span-2">
                <div class="bg-black rounded-lg aspect-video mb-4">
                    <div class="flex items-center justify-center h-full text-white">
                        <div class="text-center">
                            <i class="fas fa-play-circle text-6xl mb-4"></i>
                            <p>مشغل الفيديو</p>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="font-semibold text-gray-800 mb-2">وصف الدرس</h3>
                    <p class="text-gray-600 text-sm">هذا الدرس يغطي الأساسيات المهمة في الموضوع المحدد...</p>
                </div>
            </div>
            
            <!-- Course Content -->
            <div class="lg:col-span-1">
                <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="font-semibold text-gray-800 mb-4">محتوى الكورس</h3>
                    <div id="courseLessons" class="space-y-2">
                        <!-- Lessons will be loaded here -->
                    </div>
                </div>
                
                <!-- Progress -->
                <div class="bg-white border rounded-lg p-4 mt-4">
                    <h4 class="font-semibold text-gray-800 mb-2">التقدم</h4>
                    <div class="progress-bar mb-2">
                        <div class="progress-fill" style="width: 30%"></div>
                    </div>
                    <p class="text-sm text-gray-600">3 من 10 دروس مكتملة</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Student Modal -->
<div id="addStudentModal" class="modal">
    <div class="bg-white p-8 rounded-lg shadow-2xl max-w-md w-full mx-4">
        <div class="text-center mb-6">
            <h2 class="text-2xl font-bold text-gray-800">إضافة طالب جديد</h2>
        </div>
        <form id="addStudentForm">
            <div class="mb-4">
                <label class="form-label">الاسم الكامل</label>
                <input type="text" required class="form-input" placeholder="أدخل اسم الطالب">
            </div>
            <div class="mb-4">
                <label class="form-label">البريد الإلكتروني</label>
                <input type="email" required class="form-input" placeholder="أدخل البريد الإلكتروني">
            </div>
            <div class="mb-4">
                <label class="form-label">رقم الهاتف</label>
                <input type="tel" required class="form-input" placeholder="أدخل رقم الهاتف">
            </div>
            <div class="mb-6">
                <label class="form-label">الكورسات المسجلة</label>
                <div class="space-y-2 max-h-32 overflow-y-auto">
                    <!-- Course checkboxes will be loaded here -->
                </div>
            </div>
            <div class="flex justify-end space-x-4 space-x-reverse">
                <button type="button" onclick="closeModal('addStudentModal')" class="btn-secondary">إلغاء</button>
                <button type="submit" class="btn-primary">إضافة الطالب</button>
            </div>
        </form>
        <button onclick="closeModal('addStudentModal')" class="absolute top-4 left-4 text-gray-400 hover:text-gray-600">
            <i class="fas fa-times"></i>
        </button>
    </div>
</div>

<!-- Notification -->
<div id="notification" class="notification">
    <div class="flex items-center">
        <i id="notificationIcon" class="fas fa-info-circle text-blue-500 ml-3"></i>
        <span id="notificationMessage">رسالة التنبيه</span>
    </div>
</div>

<script>
// Coupon functionality
function applyCoupon() {
    const couponCode = document.getElementById('couponCode').value.trim();
    const couponMessage = document.getElementById('couponMessage');
    
    if (!couponCode) {
        couponMessage.textContent = 'يرجى إدخال كود الخصم';
        couponMessage.className = 'text-sm mt-2 text-red-600';
        couponMessage.classList.remove('hidden');
        return;
    }
    
    const coupon = coupons.find(c => c.code === couponCode && c.active);
    
    if (coupon) {
        const originalPrice = parseFloat(document.getElementById('originalPrice').textContent.replace(/[^\d.]/g, ''));
        let discount = 0;
        
        if (coupon.type === 'percentage') {
            discount = originalPrice * (coupon.discount / 100);
        } else {
            discount = coupon.discount;
        }
        
        const finalPrice = Math.max(0, originalPrice - discount);
        
        document.getElementById('discountRow').classList.remove('hidden');
        document.getElementById('discountAmount').textContent = `-${discount} ج.م`;
        document.getElementById('finalPrice').textContent = `${finalPrice} ج.م`;
        
        couponMessage.textContent = `تم تطبيق الخصم بنجاح! وفرت ${discount} ج.م`;
        couponMessage.className = 'text-sm mt-2 text-green-600';
        couponMessage.classList.remove('hidden');
    } else {
        couponMessage.textContent = 'كود الخصم غير صحيح أو منتهي الصلاحية';
        couponMessage.className = 'text-sm mt-2 text-red-600';
        couponMessage.classList.remove('hidden');
    }
}

function toggleDiscountType(type) {
    // Implementation for discount type toggle
}

// Format card number input
document.addEventListener('DOMContentLoaded', function() {
    const cardInput = document.querySelector('input[placeholder="1234 5678 9012 3456"]');
    if (cardInput) {
        cardInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\s/g, '').replace(/[^0-9]/gi, '');
            let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
            e.target.value = formattedValue;
        });
    }
    
    const expiryInput = document.querySelector('input[placeholder="MM/YY"]');
    if (expiryInput) {
        expiryInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 2) {
                value = value.substring(0, 2) + '/' + value.substring(2, 4);
            }
            e.target.value = value;
        });
    }
});
</script>
